<!DOCTYPE html>

<!-- ottohub-electron is an open source ottohub.cn client packed by electron
Copyright (C) 2024-2025  Yu Hongbo, CNOCTAVE

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>. -->

<html>

<head>
    <title>ottohub-electron</title>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <meta name="theme-color" content="#00B4FF">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="msapplication-TileImage" content="/favicon.ico">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="apple-mobile-web-app-title" content="Octave中文网">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="title" content="Octave中文网" data-qmeta="title">
    <meta property="og:title" content="Octave中文网" data-qmeta="ogTitle">
    <meta name="twitter:title" content="Octave中文网" data-qmeta="twitterTitle">
    <meta name="description" content="Octave中文网是一个面向中文Octave开发者的交流平台，拥有中文Octave文档、中文Octave论坛和中文Octave新闻等特色。"
        data-qmeta="description">
    <meta property="og:description" content="Octave中文网是一个面向中文Octave开发者的交流平台，拥有中文Octave文档、中文Octave论坛和中文Octave新闻等特色。"
        data-qmeta="ogDesc">
    <meta name="twitter:description" content="Octave中文网是一个面向中文Octave开发者的交流平台，拥有中文Octave文档、中文Octave论坛和中文Octave新闻等特色。"
        data-qmeta="twitterDesc">
    <link href="MaterialIcons.css" rel="stylesheet" type="text/css">
    <link href="fontawesome/fontawesome5.css" rel="stylesheet" type="text/css">
    <link href="fontawesome/fontawesome6.css" rel="stylesheet" type="text/css">
    <link href="animate.css" rel="stylesheet" type="text/css">
    <link href="quasar.css" rel="stylesheet" type="text/css">
    <link href="main.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/flv.js@latest/dist/flv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/danmaku/dist/danmaku.min.js"></script>
</head>

<body>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.css">
    <!-- <style>
        #dplayer {
            width: 800px;
            height: 450px;
            margin: 0;
        }
    </style> -->
    <div id="q-app">
        <q-layout view="hHh LpR fFf">
            <div class="q-ma-md navbar_div">
                <q-input filled v-model="text" label="万能搜索" style="width: 100%; margin-right: 0;"
                    v-show="innerWidth <= 1080">
                    <template v-slot:append>
                        <q-btn color="primary" @click="goToID(`search.html?keyword=${text}`)">
                            <q-icon left name="search"></q-icon>
                            <div>搜索</div>
                        </q-btn>
                    </template>
                </q-input>
                <div class="avatar_div">
                    <q-avatar color="green" text-color="white" icon="tv"></q-avatar>
                    <div>视频</div>
                    <q-popup-proxy>
                        <q-banner>
                            <q-list>
                                <q-item clickable v-ripple @click="goToID('index.html?type=1&category=1')">
                                    <q-item-section avatar>
                                        <q-icon color="primary" name="window"></q-icon>
                                    </q-item-section>
                                    <q-item-section>分区视频</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('index.html?type=2')">
                                    <q-item-section avatar>
                                        <q-icon color="primary" name="shuffle"></q-icon>
                                    </q-item-section>
                                    <q-item-section>随机视频</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('index.html?type=3&offset=0')">
                                    <q-item-section avatar>
                                        <q-icon color="primary" name="access_time"></q-icon>
                                    </q-item-section>
                                    <q-item-section>最新视频</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('index.html?type=4&offset=0&time_limit=7')">
                                    <q-item-section avatar>
                                        <q-icon color="primary" name="bar_chart"></q-icon>
                                    </q-item-section>
                                    <q-item-section>本周热门</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('index.html?type=4&offset=0&time_limit=30')">
                                    <q-item-section avatar>
                                        <q-icon color="primary" name="trending_up"></q-icon>
                                    </q-item-section>
                                    <q-item-section>本月热门</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('index.html?type=4&offset=0&time_limit=90')">
                                    <q-item-section avatar>
                                        <q-icon color="primary" name="whatshot"></q-icon>
                                    </q-item-section>
                                    <q-item-section>本季热门</q-item-section>
                                </q-item>
                            </q-list>
                        </q-banner>
                    </q-popup-proxy>
                </div>
                <div class="avatar_div" @click="goToID('blog_list.html?type=1')">
                    <q-avatar color="red" text-color="white" icon="create"></q-avatar>
                    <div>动态</div>
                </div>
                <q-input filled v-model="text" label="万能搜索" v-show="innerWidth > 1080">
                    <template v-slot:append>
                        <q-btn color="primary" @click="goToID(`search.html?keyword=${text}`)">
                            <q-icon left name="search"></q-icon>
                            <div>搜索</div>
                        </q-btn>
                    </template>
                </q-input>
                <div class="avatar_div">
                    <q-avatar color="teal" text-color="white" icon="menu">
                        <q-badge color="red" floating v-show="new_message_num_ > 0">{{new_message_num_}}</q-badge>
                    </q-avatar>
                    <div>其他</div>
                    <q-popup-proxy>
                        <q-banner>
                            <q-list>
                                <q-item clickable v-ripple @click="goToID('im.html')">
                                    <q-item-section avatar>
                                        <q-icon color="teal" name="sms"></q-icon>
                                    </q-item-section>
                                    <q-item-section>消息</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('my.html')">
                                    <q-item-section avatar>
                                        <q-icon color="purple-12" name="man"></q-icon>
                                    </q-item-section>
                                    <q-item-section>我的</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('admin.html')">
                                    <q-item-section avatar>
                                        <q-icon color="primary" name="settings"></q-icon>
                                    </q-item-section>
                                    <q-item-section>管理页面</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('submit_video.html')">
                                    <q-item-section avatar>
                                        <q-icon color="green" name="tv"></q-icon>
                                    </q-item-section>
                                    <q-item-section>发布视频</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('submit_blog.html')">
                                    <q-item-section avatar>
                                        <q-icon color="purple-12" name="create"></q-icon>
                                    </q-item-section>
                                    <q-item-section>发布动态</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple @click="goToID('docs/index.html')">
                                    <q-item-section avatar>
                                        <q-icon color="yellow-10" name="help"></q-icon>
                                    </q-item-section>
                                    <q-item-section>使用帮助</q-item-section>
                                </q-item>
                            </q-list>
                        </q-banner>
                    </q-popup-proxy>
                </div>
                <div class="avatar_div" @click="goToLogin()">
                    <q-avatar class="cursor-pointer">
                        <img :src="sessionStorage_avatar_url">
                    </q-avatar>
                </div>
            </div>
            <q-separator></q-separator>
            <div class="row justify-center" v-show="innerWidth <= 1080">
                <div class="col" style="display: flex; 
                                        justify-content: center;
                                        align-items: center;">
                    <div class="q-ml-md text-h4" style="width: 100%; text-align: start;">分区</div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=1')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">鬼畜</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=3')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">人力VOCALOID</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=4')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">剧场</div>
                    </div>
                </div>
            </div>
            <div class="row justify-center" v-show="innerWidth <= 1080">
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=5')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">游戏</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=6')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">怀旧</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=7')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">音乐</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=0')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">其他</div>
                    </div>
                </div>
            </div>
            <div class="row justify-center" v-show="innerWidth > 1080">
                <div class="col" style="display: flex; 
                                        justify-content: center;
                                        align-items: center;">
                    <div class="q-ml-md text-h4" style="width: 100%; text-align: start;">分区</div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=1')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">鬼畜</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=3')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">人力VOCALOID</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=4')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">剧场</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=5')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">游戏</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=6')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">怀旧</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=7')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">音乐</div>
                    </div>
                </div>
                <div class="col" style="display: flex;
                                        justify-content: center;
                                        align-items: flex-start;">
                    <div class="q-mx-md avatar_div cursor-pointer" @click="goToID('index.html?type=1&category=0')">
                        <q-avatar color="primary" text-color="white" icon="directions"></q-avatar>
                        <div style="text-align: center;">其他</div>
                    </div>
                </div>
            </div>
            <q-separator></q-separator>
            <q-page-container>
                <div>
                    <div class="q-mx-md navbar_div">
                        <div class="text-h4">{{video_info.title}}</div>
                        <q-btn stretch flat color="red" icon="report" label="举报" @click="report_video(video_info.vid, sessionStorage_token)"></q-btn>
                    </div>
                    <q-separator></q-separator>
                    <div class="q-mx-md">
                        <div style="display: flex; 
                                justify-content: space-between;
                                flex-direction: row;
                                flex-wrap: wrap;
                                align-items: flex-start;">
                            <div id="dplayer-outline" style="position: relative;">
                                <div id="dplayer" style="display: block; height: 100%;"></div>
                                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                    <div class="q-mx-md avatar_div"
                                        @click="like_video(video_info.vid, sessionStorage_token)">
                                        <q-avatar color="green" text-color="white" icon="thumb_up"></q-avatar>
                                        <div>点赞&nbsp;{{video_info.like_count}}</div>
                                    </div>
                                    <div class="q-mx-md avatar_div"
                                        @click="favorite_video(video_info.vid, sessionStorage_token)">
                                        <q-avatar color="yellow-10" text-color="white" icon="star"></q-avatar>
                                        <div>收藏&nbsp;{{video_info.favorite_count}}</div>
                                    </div>
                                    <div class="q-mx-md avatar_div" @click="xdm=true; dp.pause();">
                                        <q-avatar color="teal" text-color="white" icon="chat"></q-avatar>
                                        <div>发送弹幕&nbsp;{{danmaku.length}}</div>
                                    </div>
                                    <div class="q-mx-md avatar_div" @click="xpl=true; dp.pause();">
                                        <q-avatar color="primary" text-color="white" icon="edit"></q-avatar>
                                        <div>写评论</div>
                                    </div>
                                </div>
                            </div>
                            <q-list id="dplayer_list">
                                <q-item clickable v-ripple>
                                    <q-item-section>
                                        <q-img :src="video_info.cover_url" spinner-color="white"
                                            style="height: 20vh; width: 16vw; min-width: 320px; min-height: 240px;">
                                        </q-img>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>
                                        <q-avatar class="cursor-pointer"
                                            @click="goToID(`search.html?keyword=${video_info.uid}`)">
                                            <img :src="video_info.avatar_url">
                                        </q-avatar>
                                        <q-item-label style="line-break: anywhere;">
                                            {{video_info.username}}
                                        </q-item-label>
                                    </q-item-section>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            {{video_info.userintro}}
                                        </q-item-label>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>
                                        <q-btn color="primary" icon="home" label="个人主页"
                                            @click="goToID('personal_page.html?uid=' + video_info.uid)"></q-btn>
                                    </q-item-section>
                                    <q-item-section>
                                        <q-btn color="yellow-10" icon="chat" label="发送消息"
                                            @click="goToID('im.html?uid=' + video_info.uid)"></q-btn>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>
                                        <q-btn color="purple-12" icon="list" label="获取视频所属合集列表"
                                            @click="get_video_collection(video_info.vid); get_video_collection_dialog=true;"></q-btn>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>
                                        <q-btn color="purple-12" icon="list" label="用户拥有的视频合集"
                                            @click="get_user_video_collection(video_info.uid)"></q-btn>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            <q-badge color="teal" class="q-mr-md"
                                                v-if="follow_status_ === 0">这是我自己</q-badge>
                                            <q-badge color="teal" class="q-mr-md"
                                                v-else-if="follow_status_ === 1">互相未关注</q-badge>
                                            <q-badge color="teal" class="q-mr-md"
                                                v-else-if="follow_status_ === 2">我关注对方</q-badge>
                                            <q-badge color="teal" class="q-mr-md"
                                                v-else-if="follow_status_ === 3">对方关注我</q-badge>
                                            <q-badge color="teal" class="q-mr-md"
                                                v-else-if="follow_status_ === 4">互相关注</q-badge>
                                            <q-badge color="teal" class="q-mr-md" v-else>关注状态未知</q-badge>
                                        </q-item-label>
                                    </q-item-section>
                                    <q-item-section>
                                        <q-btn color="red" icon="close" label="不能关注自己" disable
                                            v-if="follow_status_ === 0"></q-btn>
                                        <q-btn color="green" icon="add"
                                            :label="(follow_status_ === 1) || (follow_status_ === 3) ? '关注': '已关注'"
                                            :disable="(follow_status_ === 0) || (follow_status_ === 2) || (follow_status_ === 4)"
                                            v-else-if="(follow_status_ === 1) || (follow_status_ === 2) || (follow_status_ === 3) || (follow_status_ === 4)"
                                            @click="follow(video_info.uid, sessionStorage_token)"></q-btn>
                                        <q-btn color="red" icon="close" label="登录后关注" disable v-else></q-btn>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>OV{{video_info.vid}}</q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            {{video_info.intro}}
                                        </q-item-label>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>标签</q-item-section>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            <q-badge color="blue" class="q-mr-md" v-for="(v, k) in video_info_tags"
                                                :key="k">
                                                {{v}}
                                            </q-badge>
                                        </q-item-label>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>发布时间</q-item-section>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            {{video_info.time}}
                                        </q-item-label>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>点赞</q-item-section>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            {{video_info.like_count}}
                                        </q-item-label>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>收藏</q-item-section>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            {{video_info.favorite_count}}
                                        </q-item-label>
                                    </q-item-section>
                                </q-item>
                                <q-separator></q-separator>
                                <q-item clickable v-ripple>
                                    <q-item-section>观看次数</q-item-section>
                                    <q-item-section>
                                        <q-item-label style="line-break: anywhere;">
                                            {{video_info.view_count}}
                                        </q-item-label>
                                    </q-item-section>
                                </q-item>
                            </q-list>
                        </div>
                    </div>
                </div>
            </q-page-container>
        </q-layout>
        <!-- 发送弹幕弹窗 -->
        <q-dialog v-model="xdm" full-width>
            <q-card style="background-color: #f1f1f1;">
                <q-card-section class="row items-center q-pb-none">
                    <div class="text-h6">发送弹幕</div>
                    <q-space></q-space>
                    <q-btn icon="close" flat round dense v-close-popup></q-btn>
                </q-card-section>

                <q-card-section class="q-pt-none">
                    <q-input filled v-model="text" label="输入弹幕" style="width:100%; margin-bottom: 10px;">
                    </q-input>
                    <q-field filled stack-label style="width:100%; margin-bottom: 10px;">
                        <template v-slot:control>
                            <div class="form_text">弹幕类型</div>
                            <q-radio v-model="mode" val="scroll" label="滚动" class="form_text"></q-radio>
                            <q-radio v-model="mode" val="top" label="顶部" class="form_text"></q-radio>
                            <q-radio v-model="mode" val="bottom" label="底部" class="form_text"></q-radio>
                        </template>
                    </q-field>
                    <q-field filled stack-label style="width:100%; margin-bottom: 10px;">
                        <template v-slot:control>
                            <div class="form_text">弹幕颜色&nbsp;</div>
                            <q-color v-model="color" no-header style="width:100%; margin-bottom: 10px;"></q-color>
                            <div>&emsp;</div>
                            <div class="form_text" :style="'background-color: ' + color">&emsp;&emsp;&emsp;&emsp;</div>
                            <div class="form_text" :style="'color: ' + color">{{color}}</div>
                        </template>
                    </q-field>
                    <q-input filled v-model="font_size" label="字号（px）" style="width:100%; margin-bottom: 10px;">
                    </q-input>
                    <q-input filled v-model="render" label="高级弹幕渲染方式（详见https://github.com/weizhenye/Danmaku）"
                        style="width:100%; margin-bottom: 10px;">
                    </q-input>
                    <q-btn color="primary" style="width:100%; margin-bottom: 10px;"
                        @click="send_danmaku(vid, sessionStorage_token, text, mode, color, font_size, render)">
                        <q-icon left name="send"></q-icon>
                        <div>发送弹幕</div>
                    </q-btn>
                    <q-separator></q-separator>
                    <div class="text-h6">全部弹幕</div>
                    <q-list>
                        <q-item clickable v-ripple v-for="(v, k) in danmaku" :key="k">
                            <q-item-section>
                                <div style="display: flex; background-color: #f1f1f1;">
                                    <div :style="'font-size:' + v.font_size">第{{v.time}}秒：</div>
                                    <div
                                        :style="`color: ${v.color};font-size: ${v.font_size};font-size: ${v.font_size};${render}`">
                                        {{v.text}}</div>
                                    <q-space></q-space>
                                    <q-btn color="red" label="删除"
                                        @click="delete_danmaku(v.danmaku_id, sessionStorage_token)"></q-btn>
                                    <div>&nbsp;</div>
                                    <q-btn color="red" label="举报"
                                        @click="report_danmaku(v.danmaku_id, sessionStorage_token)"></q-btn>
                                </div>
                            </q-item-section>
                            <q-separator></q-separator>
                        </q-item>
                    </q-list>
                </q-card-section>
            </q-card>
        </q-dialog>
        <!-- 发送评论弹窗 -->
        <q-dialog v-model="xpl" full-width>
            <q-card style="background-color: #f1f1f1;">
                <q-card-section class="row items-center q-pb-none">
                    <div class="text-h6">发送评论</div>
                    <q-space></q-space>
                    <q-btn icon="close" flat round dense v-close-popup></q-btn>
                </q-card-section>

                <q-card-section class="q-pt-none">
                    <q-input filled v-model="text" label="输入评论" style="width:100%; margin-bottom: 10px;">
                    </q-input>
                    <q-btn color="primary" style="width:100%; margin-bottom: 10px;"
                        @click="comment_video(vid, '0', sessionStorage_token, text)">
                        <q-icon left name="send"></q-icon>
                        <div>发送评论</div>
                    </q-btn>
                    <q-separator></q-separator>
                    <div class="text-h6">全部评论</div>
                    <div class="refreshbar_div">
                        <q-btn color="primary" icon="west" label="上一页" @click="changeOffset('1', -5)"></q-btn>
                        <div>&nbsp;</div>
                        <q-btn color="primary" icon-right="east" label="下一页" @click="changeOffset('1', 5)"></q-btn>
                    </div>
                    <div class="flexcards-container q-mn-md" style="width: 100%">
                        <q-list style="width: 100%">
                            <q-item clickable v-ripple v-for="(v, k) in comment_list_1" :key="k"
                                style="border-bottom:1px solid rgb(226, 226, 226);">
                                <q-item-section class="col-md-auto" @click="goToID(`search.html?keyword=${v.uid}`)">
                                    <q-avatar class="cursor-pointer" @click="goToID(`search.html?keyword=${v.uid}`)">
                                        <img :src="v.avatar_url">
                                    </q-avatar>
                                    <q-item-label>
                                        {{v.username}}<br>UID{{v.uid}}
                                    </q-item-label>
                                </q-item-section>
                                <q-item-section>
                                    <div v-html="v.content"></div>
                                </q-item-section>
                                <q-item-section class="col-md-auto"
                                    style="max-width: 30vw; text-align: center;">{{v.time}}</q-item-section>
                                <q-item-section class="col-md-auto q-mx-md"
                                    style="display: flex; flex-direction: row; align-content: center;">
                                    <q-btn color="primary" label="展开" @click="offset2=0; video_comment_list(video_info.vid, v.vcid, '0', '5'); 
                                    vcid=v.vcid; comment2=v; xpl2=true"></q-btn>
                                    <div>&nbsp;</div>
                                    <q-btn color="red" label="删除" @click="delete_video_comment(v.vcid, token)"></q-btn>
                                    <div>&nbsp;</div>
                                    <q-btn color="red" label="举报" @click="report_video_comment(v.vcid, token)"></q-btn>
                                    <div>&nbsp;</div>
                                </q-item-section>
                                <q-separator></q-separator>
                            </q-item>
                        </q-list>
                    </div>
                </q-card-section>
            </q-card>
        </q-dialog>
        <!-- 发送楼中楼评论弹窗 -->
        <q-dialog v-model="xpl2" full-width>
            <q-card style="background-color: #f1f1f1;">
                <q-card-section class="row items-center q-pb-none">
                    <div class="text-h6">发送评论</div>
                    <q-space></q-space>
                    <q-btn icon="close" flat round dense v-close-popup></q-btn>
                </q-card-section>

                <q-card-section class="q-pt-none">
                    <div class="flexcards-container q-mn-md" style="width: 100%">
                        <q-list style="width: 100%">
                            <q-item clickable v-ripple style="border-bottom:1px solid rgb(226, 226, 226);">
                                <q-item-section class="col-md-auto"
                                    @click="goToID(`search.html?keyword=${comment2.uid}`)">
                                    <q-avatar class="cursor-pointer"
                                        @click="goToID(`search.html?keyword=${comment2.uid}`)">
                                        <img :src="comment2.avatar_url">
                                    </q-avatar>
                                    <q-item-label>
                                        {{comment2.username}}<br>UID{{comment2.uid}}
                                    </q-item-label>
                                </q-item-section>
                                <q-item-section>
                                    <div v-html="comment2.content"></div>
                                </q-item-section>
                                <q-item-section class="col-md-auto"
                                    style="max-width: 30vw; text-align: center;">{{comment2.time}}</q-item-section>
                            </q-item>
                        </q-list>
                    </div>
                    <q-input filled v-model="text" label="输入评论" style="width:100%; margin-bottom: 10px;">
                    </q-input>
                    <q-btn color="primary" style="width:100%; margin-bottom: 10px;"
                        @click="comment_video(vid, comment2.vcid, sessionStorage_token, text)">
                        <q-icon left name="send"></q-icon>
                        <div>发送评论</div>
                    </q-btn>
                    <q-separator></q-separator>
                </q-card-section>
                <q-card-section class="q-pt-none" v-show="comment_list_2.length != 0">
                    <div class="text-h6">本楼评论</div>
                    <div class="refreshbar_div">
                        <q-btn color="primary" icon="west" label="上一页" @click="changeOffset('2', -5)"></q-btn>
                        <div>&nbsp;</div>
                        <q-btn color="primary" icon-right="east" label="下一页" @click="changeOffset('2', 5)"></q-btn>
                    </div>
                </q-card-section>
                <q-card-section class="q-pt-none">
                    <q-list>
                        <q-item clickable v-ripple v-for="(v, k) in comment_list_2" :key="k">
                            <q-item-section class="col-md-auto" @click="goToID(`search.html?keyword=${v.uid}`)">
                                <q-avatar class="cursor-pointer" @click="goToID(`search.html?keyword=${v.uid}`)">
                                    <img :src="v.avatar_url">
                                </q-avatar>
                                <q-item-label>
                                    {{v.username}}<br>UID{{v.uid}}
                                </q-item-label>
                            </q-item-section>
                            <q-item-section>
                                <div v-html="v.content"></div>
                            </q-item-section>
                            <q-item-section class="col-md-auto"
                                style="max-width: 30vw; text-align: center;">{{v.time}}</q-item-section>
                            <q-item-section class="col-md-auto q-mx-md"
                                style="display: flex; flex-direction: row; align-content: center;">
                                <q-btn color="red" label="删除"
                                    @click="delete_video_comment(v.vcid, sessionStorage_token)"></q-btn>
                                <div>&nbsp;</div>
                                <q-btn color="red" label="举报"
                                    @click="report_video_comment(v.vcid, sessionStorage_token)"></q-btn>
                                <div>&nbsp;</div>
                            </q-item-section>
                            <q-separator></q-separator>
                        </q-item>
                    </q-list>
                </q-card-section>
            </q-card>
        </q-dialog>
        <!-- 获取视频所属合集列表弹窗 -->
        <q-dialog v-model="get_video_collection_dialog" full-width>
            <q-card>
                <q-card-section class="row items-center q-pb-none">
                    <div class="text-h6">获取视频所属合集列表</div>
                    <q-space></q-space>
                    <q-btn icon="close" flat round dense v-close-popup></q-btn>
                </q-card-section>

                <q-card-section class="q-pt-none">
                    <q-table title="视频列表：" :rows="get_video_collection_rows" :columns="get_video_collection_columns"
                        row-key="vid" no-data-label="无数据" :pagination-label="setPaginationLabel"
                        rows-per-page-label="每页条数：" style="width:100%;">
                        <template v-slot:body-cell-options="props">
                            <q-td :props="props">
                                <q-btn color="primary" icon="search" label="查看"
                                    @click="goToID(`video_player.html?vid=${props.row.vid}`)"></q-btn>
                                <q-input filled v-model="collection" label="视频所属合集"
                                    style="width:100%; margin-bottom: 10px; min-width: 300px;">
                                    <template v-slot:append>
                                        <q-btn color="green"
                                            @click="set_video_collection(props.row.vid, sessionStorage_token, collection)">
                                            <q-icon left name="edit"></q-icon>
                                            <div>设置</div>
                                        </q-btn>
                                    </template>
                                </q-input>
                            </q-td>
                        </template>
                        <template v-slot:body-cell-cover_url="props">
                            <q-td :props="props">
                                <q-img :src="props.row.cover_url" spinner-color="white"
                                    style="height: 20vh; width: 16vw; min-width: 320px; min-height: 240px;">
                                </q-img>
                            </q-td>
                        </template>
                        <template v-slot:body-cell-info="props">
                            <q-td :props="props">
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div><b>OV{{props.row.vid}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <q-avatar class="cursor-pointer"
                                        @click="goToID(`search.html?keyword=${props.row.uid}`)">
                                        <img :src="props.row.avatar_url">
                                    </q-avatar>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div><b>UID{{props.row.uid}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div>用户名：</div>
                                    <div><b>{{props.row.username}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div>标题：</div>
                                    <div><b>{{props.row.title}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div>时间：</div>
                                    <div><b>{{props.row.time}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <q-badge color="teal"><b>{{props.row.like_count}}</b></q-badge>
                                    <q-badge color="blue">点赞</q-badge>
                                    <q-badge color="teal"><b>{{props.row.favorite_count}}</b></q-badge>
                                    <q-badge color="orange">收藏</q-badge>
                                    <q-badge color="teal"><b>{{props.row.view_count}}</b></q-badge>
                                    <q-badge color="purple-5">查看</q-badge>
                                </div>
                            </q-td>
                        </template>
                    </q-table>
                </q-card-section>
            </q-card>
        </q-dialog>
        <!-- 用户拥有的视频合集弹窗 -->
        <q-dialog v-model="get_user_video_collection_dialog" full-width>
            <q-card>
                <q-card-section class="row items-center q-pb-none">
                    <div class="text-h6">用户拥有的视频合集</div>
                    <q-space></q-space>
                    <q-btn icon="close" flat round dense v-close-popup></q-btn>
                </q-card-section>
                <q-card-section class="row items-center q-pb-none" v-for="(v, k) in video_collection_list_" :key="k">
                    <div class="text-h6">视频合集：{{v.name}}</div>
                    <q-table title="视频列表：" :rows="v.video_list" :columns="get_video_collection_columns" row-key="vid"
                        no-data-label="无数据" :pagination-label="setPaginationLabel" rows-per-page-label="每页条数："
                        style="width:100%;">
                        <template v-slot:body-cell-options="props">
                            <q-td :props="props">
                                <q-btn color="primary" icon="search" label="查看"
                                    @click="goToID(`video_player.html?vid=${props.row.vid}`)"></q-btn>
                                <q-input filled v-model="collection" label="视频所属合集"
                                    style="width:100%; margin-bottom: 10px; min-width: 300px;">
                                    <template v-slot:append>
                                        <q-btn color="green"
                                            @click="set_video_collection(props.row.vid, sessionStorage_token, collection)">
                                            <q-icon left name="edit"></q-icon>
                                            <div>设置</div>
                                        </q-btn>
                                    </template>
                                </q-input>
                            </q-td>
                        </template>
                        <template v-slot:body-cell-cover_url="props">
                            <q-td :props="props">
                                <q-img :src="props.row.cover_url" spinner-color="white"
                                    style="height: 20vh; width: 16vw; min-width: 320px; min-height: 240px;">
                                </q-img>
                            </q-td>
                        </template>
                        <template v-slot:body-cell-info="props">
                            <q-td :props="props">
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div><b>OV{{props.row.vid}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <q-avatar class="cursor-pointer"
                                        @click="goToID(`search.html?keyword=${props.row.uid}`)">
                                        <img :src="props.row.avatar_url">
                                    </q-avatar>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div><b>UID{{props.row.uid}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div>用户名：</div>
                                    <div><b>{{props.row.username}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div>标题：</div>
                                    <div><b>{{props.row.title}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <div>时间：</div>
                                    <div><b>{{props.row.time}}</b></div>
                                </div>
                                <div class="q-mx-md" style="display: flex; flex-direction: row; align-content: center;">
                                    <q-badge color="teal"><b>{{props.row.like_count}}</b></q-badge>
                                    <q-badge color="blue">点赞</q-badge>
                                    <q-badge color="teal"><b>{{props.row.favorite_count}}</b></q-badge>
                                    <q-badge color="orange">收藏</q-badge>
                                    <q-badge color="teal"><b>{{props.row.view_count}}</b></q-badge>
                                    <q-badge color="purple-5">查看</q-badge>
                                </div>
                            </q-td>
                        </template>
                    </q-table>
                </q-card-section>
            </q-card>
        </q-dialog>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="vue.js"></script>
    <script src="quasar.js"></script>
    <!-- <script>
        function setInitialScale() {
            const screenWidth = window.screen.width;
            const initialScale = screenWidth / 700;
            const minScale = 0.5;
            const maxScale = 2.0;
            const scale = Math.min(maxScale, Math.max(minScale, initialScale));
            document.querySelector('meta[name="viewport"]').setAttribute(
                'content', 
                `width=700, initial-scale=${scale}, minimum-scale=${minScale}, maximum-scale=${maxScale}`
            );
        }
        window.addEventListener('load', setInitialScale);
        window.addEventListener('resize', setInitialScale);
    </script> -->
    <script>
        const App = {
            data() {
                return {
                    sessionStorage_token: sessionStorage.getItem('token'),
                    sessionStorage_uid: sessionStorage.getItem('uid'),
                    sessionStorage_cover_url: sessionStorage.getItem('cover_url'),
                    sessionStorage_avatar_url: sessionStorage.getItem('avatar_url') ? sessionStorage.getItem('avatar_url') : 'https://api.ottohub.cn/public/img/avatar_default.jpg',
                    // 跳转登录
                    goToLogin() {
                        window.open('login.html?from=' + encodeURIComponent(window.location.href), '_self');
                    },
                    // 跳转方法
                    goToID(target) {
                        window.open(target, '_self');
                    },
                    setPaginationLabel(firstRowIndex, endRowIndex, totalRowsNumber) {
                        return (
                            "第" +
                            firstRowIndex +
                            " - " +
                            endRowIndex +
                            "条记录，共" +
                            totalRowsNumber +
                            "条记录"
                        );
                    },
                    vid: '',
                    new_dp() {
                        this.dp = new DPlayer({
                            container: document.getElementById('dplayer'),
                            autoplay: true,
                            video: {
                                url: `https://cdn.ottohub.cn/video/video_video/video_video_${this.vid}.mp4`,
                            },
                        })
                        let danmaku_container = document.createElement("div");
                        danmaku_container.setAttribute("id", "danmaku_container");
                        document.getElementById('dplayer').appendChild(danmaku_container);
                        // 自动连播
                        this.dp.on('ended', async () => {
                            const url = 'https://api.ottohub.cn/';
                            const params = {
                                module: 'video',
                                action: 'random_video_list',
                                num: 1
                            };
                            const response = await axios.get(url, { params });
                            window.open('video_player.html?vid=' + response.data.video_list[0].vid, '_self');
                        });
                        this.dp.on('error', async () => {
                            const url = 'https://api.ottohub.cn/';
                            const params = {
                                module: 'video',
                                action: 'random_video_list',
                                num: 1
                            };
                            const response = await axios.get(url, { params });
                            window.open('video_player.html?vid=' + response.data.video_list[0].vid, '_self');
                        });
                    },
                    new_dm() {
                        this.dm = new Danmaku({
                            container: document.getElementById('danmaku_container'),
                            engine: 'css3',
                            media: this.dp.video,
                            comments: this.danmaku_,
                        })
                        // 添加 resize 监听（可用于窗口变化、全屏切换等）
                        window.addEventListener("resize", () => {
                            this.dm.resize();
                        });
                    },
                    convertToDanmakuJSFormat(rawComments) {
                        return rawComments.map(comment => {
                            const base = {
                                time: comment.time,
                                mode: comment.mode || "scroll"
                            };
                            const color = comment.color || "#ffffff";
                            const fontSize = comment.font_size || "20px";
                            const textShadow = this.getSmartTextShadow(color);
                            if (comment.render) {
                                // // 使用自定义渲染函数
                                // base.render = comment.render;
                                try {
                                    // 如果是字符串，转成函数
                                    if (typeof comment.render === "string") {
                                        base.render = new Function("return " + comment.render)();
                                    } else if (typeof comment.render === "function") {
                                        base.render = comment.render;
                                    }
                                } catch (e) {
                                    console.warn("render 函数解析失败:", e);
                                    base.text = "[Render Error]";
                                    base.style = { color, fontSize, textShadow };
                                }
                            } else {
                                // 使用默认 text 和样式渲染
                                base.text = comment.text;
                                base.style = {
                                    color,
                                    fontSize,
                                    textShadow
                                };
                            }
                            return base;
                        });
                    },
                    getSmartTextShadow(color) {
                        try {
                            const [r, g, b] = hexToRGB(color);
                            const luma = 0.299 * r + 0.587 * g + 0.114 * b;
                            const edgeColor = luma > 160 ? "#000" : "#fff";
                            return `-1px -1px 0 ${edgeColor}, 1px -1px 0 ${edgeColor}, -1px 1px 0 ${edgeColor}, 1px 1px 0 ${edgeColor}`;
                        } catch {
                            // 如果颜色格式错误，默认黑描边
                            return "-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000";
                        }
                    },
                    dp: null,
                    video_info:
                    {
                        "status": "",
                        "vid": "",
                        "uid": "",
                        "title": "",
                        "intro": "",
                        "type": "",
                        "category": "",
                        "tag": "",
                        "time": "",
                        "like_count": "",
                        "favorite_count": "",
                        "view_count": "",
                        "cover_url": "",
                        "video_url": "",
                        "username": "",
                        "userintro": "",
                        "avatar_url": "",
                        "if_like": 0,
                        "if_favorite": 0
                    },
                    // 指定视频
                    id_video_list: async (vid) => {
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'video',
                            action: 'get_video_detail',
                            vid: vid,
                        };
                        const response = await axios.get(url, { params });
                        this.video_info = response.data;
                        this.follow_status(this.video_info.uid, this.sessionStorage_token);
                        this.video_comment_list(this.video_info.vid, '0', this.offset1, '5');
                    },
                    // 获取视频信息
                    hqspxx: (vid) => {
                        this.id_video_list(vid);
                    },
                    // 获取弹幕
                    get_danmaku: async (vid) => {
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'danmaku',
                            action: 'get_danmaku',
                            vid: vid,
                        };
                        const response = await axios.get(url, { params });
                        this.danmaku = response.data.data;
                        this.danmaku_ = this.convertToDanmakuJSFormat(this.danmaku);
                        this.new_dp();
                        this.new_dm();
                    },
                    // 发送弹幕
                    send_danmaku: async (vid, token, text, mode, color, font_size, render) => {
                        if (!this.sessionStorage_token){
                            this.goToLogin();
                        }
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'danmaku',
                            action: 'send_danmaku',
                            vid: vid,
                            token: token,
                            text: text ? text.trim() : '',
                            time: this.dp.video.currentTime,
                            mode: mode,
                            color: color.replace('#', ''),
                            font_size: font_size + 'px',
                            render: render ? render.trim() : '',
                        };
                        const response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_type': '错误数值类型',
                                'error_time': '错误时间',
                                'error_mode': '错误弹幕类型',
                                'error_color': '错误颜色',
                                'error_font_size': '错误字号',
                                'warn': '触发敏感词',
                                'text_too_long': '弹幕太长',
                                'text_too_short': '弹幕太短',
                                'render_too_long': '渲染语句太长',
                                'no_permission': '没有权限',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '发送弹幕失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '发送弹幕成功'
                            });
                        }
                        this.get_danmaku(this.vid);
                    },
                    // 删除弹幕
                    delete_danmaku: async (danmaku_id, token) => {
                        if (!this.sessionStorage_token){
                            this.goToLogin();
                        }
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'danmaku',
                            action: 'delete_danmaku',
                            danmaku_id: danmaku_id,
                            token: token,
                        };
                        const response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_type': '错误数值类型',
                                'error_danmaku_id': '错误弹幕编号',
                                'no_permission': '没有权限',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '删除弹幕失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '删除弹幕成功'
                            });
                        }
                        this.get_danmaku(this.vid);
                    },
                    // 举报弹幕
                    report_danmaku: async (danmaku_id, token) => {
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'danmaku',
                            action: 'report_danmaku',
                            danmaku_id: danmaku_id,
                            token: token,
                        };
                        const response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_type': '错误数值类型',
                                'error_danmaku_id': '错误弹幕编号',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '举报弹幕失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '举报弹幕成功'
                            });
                        }
                        this.get_danmaku(this.vid);
                    },
                    // 关注用户
                    follow: async (following_uid, token) => {
                        if (!this.sessionStorage_token){
                            this.goToLogin();
                        }
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'following',
                            action: 'follow',
                            following_uid: following_uid,
                            token: token,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_following_uid': '错误关注对象',
                                'too_many_followings': '关注者超过888人',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '关注用户失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '关注用户成功'
                            });
                            this.fans_count = response.data.new_fans_count;
                            this.follow_status_ = response.data.follow_status;
                        }
                    },
                    // 关注状态
                    follow_status: async (following_uid, token) => {
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'following',
                            action: 'follow_status',
                            following_uid: following_uid,
                            token: token,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            // let dict = {
                            //     'system_error': '系统错误',
                            //     'too_many_requests': '请求频率过高',
                            //     'missing_argument': '缺少参数',
                            //     'error_token': '错误token',
                            //     'error_following_uid': '错误关注对象',
                            // }
                            // Quasar.Notify.create({
                            //     type: 'negative',
                            //     message: '获取关注状态失败：' + dict[response.data.message]
                            // });
                            return;
                        }
                        else {
                            this.follow_status_ = response.data.follow_status;
                        }
                    },
                    // 视频评论列表
                    video_comment_list: async (vid, parent_vcid, offset, num) => {
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'comment',
                            action: 'video_comment_list',
                            vid: vid,
                            parent_vcid: parent_vcid,
                            offset: offset,
                            num: num,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            return;
                        }
                        if (parent_vcid === '0') {
                            this.comment_list_1 = response.data.comment_list;
                        }
                        else {
                            this.comment_list_2 = response.data.comment_list;
                        }
                    },
                    // 评论视频或评论视频评论
                    comment_video: async (vid, parent_vcid, token, content) => {
                        if (!this.sessionStorage_token){
                            this.goToLogin();
                        }
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'comment',
                            action: 'comment_video',
                            vid: vid,
                            parent_vcid: parent_vcid,
                            token: token,
                            content: content,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'content_too_long': '评论太长',
                                'content_too_short': '评论太短',
                                'error_type': '错误数值类型',
                                'error_vid': '错误VID',
                                'error_parent_vcid': '错误VCID',
                                'error_parent': '楼中楼中楼',
                                'warn': '触发敏感词',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '评论失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '评论成功'
                            });
                            if (parent_vcid === '0') {
                                this.video_comment_list(this.video_info.vid, '0', this.offset1, '5');
                            }
                            else {
                                this.video_comment_list(this.video_info.vid, this.commend2.vcid, this.offset2, '5');
                            }
                        }
                    },
                    // 删除视频评论
                    delete_video_comment: async (vcid, token) => {
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'comment',
                            action: 'delete_video_comment',
                            vcid: vcid,
                            token: token,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_vcid': '错误VCID',
                                'no_permission': '没有权限',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '删除视频评论失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '删除视频评论成功'
                            });
                        }
                    },
                    // 举报视频评论
                    report_video_comment: async (vcid, token) => {
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'comment',
                            action: 'report_video_comment',
                            vcid: vcid,
                            token: token,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_vcid': '错误VCID',
                                'no_permission': '没有权限',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '举报视频评论失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '举报视频评论成功'
                            });
                        }
                    },
                    // 点赞视频
                    like_video: async (vid, token) => {
                        if (!this.sessionStorage_token){
                            this.goToLogin();
                        }
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'engagement',
                            action: 'like_video',
                            vid: vid,
                            token: token,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_vid': '错误VID',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '点赞视频失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            if (response.data.if_like) {
                                Quasar.Notify.create({
                                    type: 'success',
                                    message: '点赞视频成功'
                                });
                            }
                            else {
                                Quasar.Notify.create({
                                    type: 'success',
                                    message: '取消点赞视频成功'
                                });
                            }
                            this.video_info.like_count = response.data.like_count;
                        }
                    },
                    // 收藏视频
                    favorite_video: async (vid, token) => {
                        if (!this.sessionStorage_token){
                            this.goToLogin();
                        }
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'engagement',
                            action: 'favorite_video',
                            vid: vid,
                            token: token,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_vid': '错误VID',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '收藏视频失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            if (response.data.if_favorite) {
                                Quasar.Notify.create({
                                    type: 'success',
                                    message: '收藏视频成功'
                                });
                            }
                            else {
                                Quasar.Notify.create({
                                    type: 'success',
                                    message: '取消收藏视频成功'
                                });
                            }
                            this.video_info.favorite_count = response.data.favorite_count;
                        }
                    },
                    // 更改offset，不刷新页面
                    changeOffset(type, offsetChange) {
                        if (type === '1') {
                            let newOffset = parseInt(this.offset1) + offsetChange;
                            if (newOffset < 0) {
                                newOffset = 0;
                            }
                            this.offset1 = newOffset;
                            this.video_comment_list(this.video_info.vid, '0', this.offset1, '5');
                        }
                        else if (type === '2') {
                            let newOffset = parseInt(this.offset2) + offsetChange;
                            if (newOffset < 0) {
                                newOffset = 0;
                            }
                            this.offset2 = newOffset;
                            this.video_comment_list(this.video_info.vid, this.vcid, this.offset2, '5');
                        }
                    },
                    // 举报视频
                    report_video: async (vid, token) => {
                        const url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'moderation',
                            action: 'report_video',
                            vid: vid,
                            token: token,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_type': '错误数值类型',
                                'error_vid': '错误VID',
                                'no_permission': '没有权限',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '举报视频失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '举报视频成功'
                            });
                        }
                    },
                    // 获取视频所属合集列表
                    get_video_collection: async (vid) => {
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'collection',
                            action: 'get_video_collection',
                            vid: vid,
                        };
                        const response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            return;
                        }
                        else {
                            this.get_video_collection_rows = response.data.video_list;
                            this.get_video_collection_name = response.data.collection;
                        }
                    },
                    // 用户拥有的视频合集
                    get_user_video_collection: async (uid) => {
                        let url = 'https://api.ottohub.cn/';
                        let params = {
                            module: 'collection',
                            action: 'get_user_video_collection',
                            uid: uid,
                        };
                        let response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            return;
                        }
                        this.user_video_collection = response.data.collection_list;
                        let result_list = [];
                        for (v in this.user_video_collection) {
                            let url = 'https://api.ottohub.cn/';
                            let params = {
                                module: 'collection',
                                action: 'video_collection_list',
                                uid: uid,
                                collection: this.user_video_collection[v],
                            };
                            let response = await axios.get(url, { params });
                            if (response.data.status === 'error') {
                                continue;
                            }
                            else {
                                result_list.push({
                                    'name': this.user_video_collection[v],
                                    'video_list': response.data.video_list,
                                })
                            }
                        }
                        this.video_collection_list_ = result_list;
                        this.get_user_video_collection_dialog = true;
                    },
                    user_video_collection: [],
                    get_user_video_collection_name: '',
                    get_user_video_collection_dialog: false,
                    video_collection_list_: [],
                    // 设置视频所属合集
                    set_video_collection: async (vid, token, collection) => {
                        if (!this.sessionStorage_token){
                            this.goToLogin();
                        }
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'collection',
                            action: 'set_video_collection',
                            vid: vid,
                            token: token,
                            collection: collection,
                        };
                        const response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            let dict = {
                                'system_error': '系统错误',
                                'too_many_requests': '请求频率过高',
                                'missing_argument': '缺少参数',
                                'error_token': '错误token',
                                'error_type': '错误数值类型',
                                'error_collection': '错误合集',
                                'warn': '触发敏感词',
                                'text_too_long': '合集名称太长',
                                'text_too_short': '合集名称太短',
                                'no_permission': '没有权限',
                            }
                            Quasar.Notify.create({
                                type: 'negative',
                                message: '设置视频所属合集失败：' + dict[response.data.message]
                            });
                            return;
                        }
                        else {
                            Quasar.Notify.create({
                                type: 'success',
                                message: '设置视频所属合集成功'
                            });
                        }
                    },
                    // 获取视频所属合集列表columns
                    get_video_collection_columns: [
                        { name: 'cover_url', label: '封面', field: 'cover_url', align: 'left' },
                        { name: 'info', label: '视频信息', field: 'info', align: 'left' },
                        { name: 'options', label: '操作', align: 'left' },
                    ],
                    get_video_collection_rows: [],
                    get_video_collection_name: '',
                    get_video_collection_dialog: false,
                    danmaku: [],
                    danmaku_: [],
                    xdm: false,
                    xpl: false,
                    xpl2: false,
                    text: null,
                    time: 0,
                    mode: 'scroll',
                    color: '#ffffff',
                    font_size: '20',
                    render: null,
                    follow_status_: -1,
                    comment_list_1: [],
                    comment_list_2: [],
                    offset1: 0,
                    offset2: 0,
                    comment2: {},
                    vcid: '0',
                    // 未读消息数
                    new_message_num: async (token) => {
                        const url = 'https://api.ottohub.cn/';
                        const params = {
                            module: 'im',
                            action: 'new_message_num',
                            token: token,
                        };
                        const response = await axios.get(url, { params });
                        if (response.data.status === 'error') {
                            return;
                        }
                        else {
                            this.new_message_num_ = response.data.new_message_num;
                        }
                    },
                    new_message_num_: null,
                };
            },
            mounted() {
                const currentUrl = new URL(window.location.href);
                this.vid = currentUrl.searchParams.get('vid');
                this.hqspxx(this.vid);
                this.get_danmaku(this.vid);
                if (this.sessionStorage_token) {
                    setInterval(() => {
                        this.new_message_num(this.sessionStorage_token);
                    }, 5000);
                }
            },
            computed: {
                video_info_tags() {
                    return this.video_info.tag.split('#').map(tag => tag.trim()).filter(tag => tag.trim() !== '');
                },
                innerWidth() {
                    return window.innerWidth;
                }
            }
        };
        const app = Vue.createApp(App);

        app.use(Quasar)
        app.mount('#q-app')
    </script>
</body>

</html>